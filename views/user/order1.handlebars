<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

</body>

</html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{title}}</title>

    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/public/css/linearicons.css">
    <link rel="stylesheet" href="/public/css/font-awesome.min.css">
    <link rel="stylesheet" href="/public/css/themify-icons.css">
    <link rel="stylesheet" href="/public/css/bootstrap.css">
    <link rel="stylesheet" href="/public/css/owl.carousel.css">
    <link rel="stylesheet" href="/public/css/nice-select.css">
    <link rel="stylesheet" href="/public/css/nouislider.min.css">
    <link rel="stylesheet" href="/public/css/ion.rangeSlider.css" />
    <link rel="stylesheet" href="/public/css/ion.rangeSlider.skinFlat.css" />
    <link rel="stylesheet" href="/public/css/magnific-popup.css">
    <link rel="stylesheet" href="/public/css/main.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.2/css/dataTables.bootstrap4.min.css">
    <style>
        .order-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .product-image {
            width: 150px;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
        }

        .order-history {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
        }

        .order-history-item {
            margin-bottom: 20px;
        }

        body::after {
            content: "";

            background-size: cover;
            background-position: center;
            opacity: 0.5;
            /* Adjust the opacity value as per your preference */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .image-container {
            position: relative;
            width: 8rem;
            height: 10rem;
            overflow: hidden;
            border-radius: 3px;
        }

        .image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: blur(0.5px);
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 15vh;
            height: 19vh;
            background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.8));
            opacity: 10;
            /* transition: opacity 0.3s ease; */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .overlay:hover {
            opacity: 1;
        }

        .overlay-content {
            color: #fff;
            font-size: 0.8rem;
            font-weight: lighter;
        }

        @media (max-width: 576px) {
            .cart_inner .table tbody tr.cardDataClass {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
            }

            .cart_inner .table tbody tr.cardDataClass td {
                width: 100%;
            }

            .cart_inner .table tbody tr.cardDataClass td:first-child {
                margin-bottom: 10px;
            }

            .cart_inner .table tbody tr.cardDataClass td:last-child {
                display: flex;
                justify-content: flex-start;
                align-items: center;
            }
        }

        #preloader {
            background: #ffffff url(/public/images/c1bcd8a8c945b53da6b29f10a2a553c0.gif) no-repeat center center;
            background-size: 30%;
            height: 100vh;
            width: 100%;
            position: fixed;
            z-index: 100;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
</head>

<body>
    <div id="preloader"></div>
    {{>userheader1}}
    <div style="height: 29vh;"></div>
    {{#if orderDetails}}

    <section class="cart_area">
        <div class="container">
            <h2>{{message}}</h2>
            <div class="cart_inner">
                <div class="table-responsive">
                    <table class="table" id="productsTable">
                        <thead>
                            <tr>
                                <th scope="col">No</th>
                                <th scope="col">Orderid</th>
                                <th scope="col">Date</th>
                                <th scope="col">Total</th>
                                <th scope="col">Payment</th>
                                <th scope="col">Status</th>
                                <th scope="col"></th>
                            </tr>
                        </thead>
                        <tbody>

                            {{#each orderDetails}}
                            <tr class="cardDataClass">
                                <td>{{inc @index}}</td>
                                <td>
                                    <div class="media">
                                        <div class="image-container">
                                            <a href="/orderinfo/?id={{this.id}}">
                                                <img src="/public/images/products/{{this.products.[0].image}}"
                                                    style="height: 19vh;width:15vh" alt="{{this.products.[0].image}}">
                                                <div class="overlay">
                                                    <div class="overlay-content">
                                                        More..
                                                    </div>
                                                </div>
                                            </a>
                                        </div>
                                        <div class="media-body">
                                            <a href="/orderinfo/?id={{this.id}}"
                                                style="text-decoration:none;color: black;">
                                                <p>{{this.id}}</p>
                                            </a>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <h5>{{this.date}}</h5>
                                </td>
                                <td>
                                    <p style="color: black; margin-bottom: 0;">â‚¹{{this.total}}</p>
                                </td>
                                <td>
                                    <p style="color: black; margin-bottom: 0;">{{this.payment}}</p>
                                </td>
                                <td>
                                    <h5><span class="totalPriceClass">{{this.status}}</span></h5>
                                </td>
                                <td>
                                    <div class="d-flex align-items-start">
                                        {{#if cancel}}
                                        <a class="btn-sm" onclick="cancelOrder('{{this.id}}')"
                                            style="background:linear-gradient(90deg, rgba(173, 17, 155, 0.842) 0%, rgb(50, 0, 233) 100%) ;color: rgb(255, 255, 255);">Cancel
                                            Order</a>
                                        {{else if return}}
                                        <a class="btn-sm" onclick="returnOrder('{{this.id}}')"
                                            style="background:linear-gradient(90deg, rgba(10, 13, 202, 0.842) 0%, rgb(125, 164, 248) 100%) ;color: rgb(255, 255, 255);">Return
                                            Order</a>
                                        {{/if}}
                                    </div>
                                </td>
                            </tr>
                            {{/each}}

                        </tbody>
                    </table>

                </div>
            </div>
        </div>
    </section>
    {{else}}
    <div class="container">
    <h1 class="ms-5">No order</h1>

                    <img src="/public/images/storytelling_assets_2_new_thumbnail.gif" style="height: 45vh;" class="ms-5" alt="">
               </div>
    {{/if}}


    {{>userfooter}}

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    {{!--
    <script src="sweetalert2.all.min.js"></script> --}}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/911ceacc93.js" crossorigin="anonymous"></script>
    <script src="/public/js/vendor/jquery-2.2.4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
        integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>
    <script src="/public/js/vendor/bootstrap.min.js"></script>
    <script src="/public/js/jquery.ajaxchimp.min.js"></script>
    <script src="/public/js/jquery.nice-select.min.js"></script>
    <script src="/public/js/jquery.sticky.js"></script>
    <script src="/public/js/nouislider.min.js"></script>
    <script src="/public/js/countdown.js"></script>
    <script src="/public/js/jquery.magnific-popup.min.js"></script>
    <script src="/public/js/owl.carousel.min.js"></script>
    <!--gmaps Js-->
    <script src="/public/https://maps.googleapis.com/maps/api/js?key=AIzaSyCjCGmQ0Uq4exrzdcL6rvxywDDOvfAu6eE"></script>
    <script src="/public/js/gmaps.min.js"></script>
    <script src="/public/js/main.js"></script>
    <script>
        function cancelOrder(orderId) {
            Swal.fire({
                title: 'Are you sure to cancel this order?',
                text: "We apologize if something happened wrong",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Yes, Cancel it!'

            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire(
                        'Cancelled!',
                        'Order has been cancelled.',
                        'success'
                    ).then(() => {
                        window.location.href = '/cancelOrder?id=' + orderId;
                    });
                }
            });
        }
        async function returnOrder(orderId) {
            const response = await fetch(`/getOrderDate/${encodeURIComponent(orderId)}`);
            const resBody = await response.json();
            console.log(resBody)
            const deliveryDate = moment(resBody.deliveryDate);
            const currentDate = moment();

            const daysDifference = currentDate.diff(deliveryDate, 'days');
            if (daysDifference > 7) {
                // Display an error message if more than 7 days have passed since the order date
                Swal.fire({
                    title: 'Return Not Allowed',
                    text: 'More than 7 days have passed since the delivered date. Return is not allowed.',
                    icon: 'error',
                    confirmButtonText: 'OK'
                });
            }
            else {
                Swal.fire({
                    title: 'Are you sure to return this order?',
                    text: "We apologize if something happened wrong",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, retutn it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        Swal.fire(
                            'return process activated!',
                            'Order will return soon.',
                            'success'
                        ).then(() => {
                            window.location.href = '/returnOrder?id=' + orderId;
                        });
                    }
                });
            }
        }
        $(function () {
            $('#productsTable').DataTable();
        });

    </script>

    <script>
        var loader = document.getElementById("preloader")
        window.addEventListener('load', function () {
            loader.style.display = "none"
        })
    </script>



</body>

</html>